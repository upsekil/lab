<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SaintekLab Manager - Sistem Terpadu</title>
    
    <!-- LIBRARIES -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <!-- Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <!-- QRCode -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .sidebar-active { background-color: rgba(255, 255, 255, 0.1); border-left: 4px solid #3b82f6; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        .login-bg { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); }
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        .table-responsive-wrapper { -webkit-overflow-scrolling: touch; }
        /* Custom Checkbox */
        .custom-checkbox { width: 18px; height: 18px; cursor: pointer; accent-color: #2563eb; }
    </style>
</head>
<body class="text-slate-800">

<div id="app" class="h-screen w-full flex flex-col overflow-hidden">

    <!-- LOGIN / REGISTER SCREEN -->
    <div v-if="!currentUser" class="fixed inset-0 z-[100] flex items-center justify-center login-bg p-4 overflow-y-auto">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl overflow-hidden flex flex-col md:flex-row my-auto">
            <!-- Left Side (Image/Branding) -->
            <div class="w-full md:w-1/2 bg-blue-600 p-8 flex flex-col justify-center text-white relative overflow-hidden min-h-[200px]">
                <div class="absolute -right-10 -bottom-10 w-40 h-40 md:w-64 md:h-64 bg-blue-500 rounded-full opacity-50 blur-3xl"></div>
                <div class="absolute -left-10 -top-10 w-40 h-40 md:w-64 md:h-64 bg-purple-500 rounded-full opacity-30 blur-3xl"></div>
                
                <!-- Logo Display (If Available) -->
                <div v-if="settings.logo" class="relative z-10 mb-6 flex justify-start">
                    <img :src="settings.logo" class="h-24 w-24 bg-white p-2 rounded-xl shadow-lg object-contain">
                </div>

                <h1 class="text-3xl md:text-4xl font-bold mb-2 md:mb-4 relative z-10">SaintekLab</h1>
                <p class="text-blue-100 text-sm md:text-lg relative z-10">Sistem Peminjaman Terpadu Laboratorium.</p>
                <!-- Cleaned up badges -->
            </div>
            
            <!-- Right Side (Form) -->
            <div class="w-full md:w-1/2 p-6 md:p-12">
                <div class="text-right mb-4">
                    <button @click="authMode = authMode === 'login' ? 'register' : 'login'" class="text-xs md:text-sm font-bold text-blue-600 hover:underline">
                        {{ authMode === 'login' ? 'Buat Akun Baru' : 'Sudah Punya Akun?' }}
                    </button>
                </div>
                
                <h2 class="text-xl md:text-2xl font-bold text-slate-800 mb-6">{{ authMode === 'login' ? 'Login Aplikasi' : 'Registrasi Pengguna' }}</h2>

                <form @submit.prevent="handleAuth" class="space-y-3">
                    <div v-if="authMode === 'register'">
                        <label class="block text-xs font-bold text-slate-500 mb-1">Nama Lengkap</label>
                        <input v-model="authForm.name" type="text" required class="w-full px-4 py-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none bg-slate-50">
                    </div>
                    <div v-if="authMode === 'register'">
                        <label class="block text-xs font-bold text-slate-500 mb-1">NIM / NIP / NIDN</label>
                        <input v-model="authForm.nim" type="text" required class="w-full px-4 py-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none bg-slate-50">
                    </div>
                     <div v-if="authMode === 'register'">
                        <label class="block text-xs font-bold text-slate-500 mb-1">Peran (Role)</label>
                        <select v-model="authForm.role" class="w-full px-4 py-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none bg-slate-50">
                            <option value="client">Mahasiswa / Dosen (Peminjam)</option>
                            <option value="admin">Admin / Laboran (Pengelola)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">Username</label>
                        <input v-model="authForm.username" type="text" required class="w-full px-4 py-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none bg-slate-50">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">Password</label>
                        <input v-model="authForm.password" type="password" required class="w-full px-4 py-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none bg-slate-50">
                    </div>
                    
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition shadow-lg shadow-blue-500/30 mt-4">
                        {{ authMode === 'login' ? 'Masuk' : 'Daftar' }}
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- MAIN APP LAYOUT -->
    <div v-else class="flex flex-1 h-full overflow-hidden relative">
        
        <!-- MOBILE OVERLAY -->
        <div v-if="mobileMenuOpen" @click="mobileMenuOpen = false" class="fixed inset-0 bg-black/50 z-20 lg:hidden backdrop-blur-sm"></div>

        <!-- SIDEBAR -->
        <aside class="sidebar-transition absolute lg:static top-0 left-0 h-full bg-slate-900 text-white flex flex-col shadow-xl z-30 w-64 transform lg:translate-x-0"
               :class="mobileMenuOpen ? 'translate-x-0' : '-translate-x-full'">
            
            <div class="h-16 flex items-center justify-between px-4 border-b border-slate-700">
                <div class="flex items-center gap-2 font-bold text-xl tracking-wider text-blue-400">
                    <i class="fa-solid fa-flask"></i> SAINTEK<span class="text-white">LAB</span>
                </div>
                <button @click="mobileMenuOpen = false" class="lg:hidden text-slate-400 hover:text-white">
                    <i class="fa-solid fa-times text-xl"></i>
                </button>
            </div>

            <div class="p-4 border-b border-slate-800 flex items-center gap-3">
                <div class="h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold shrink-0 text-sm">
                    {{ getInitials(currentUser.name) }}
                </div>
                <div class="overflow-hidden">
                    <p class="text-sm font-bold truncate w-40">{{ currentUser.name }}</p>
                    <p class="text-xs text-slate-400 uppercase tracking-wider">{{ currentUser.role }}</p>
                </div>
            </div>

            <nav class="flex-1 py-6 overflow-y-auto space-y-1">
                <template v-for="(item, index) in currentMenuItems" :key="index">
                    <a href="#" @click.prevent="navigate(item.id)" 
                       class="flex items-center px-6 py-3 text-slate-300 hover:bg-slate-800 hover:text-white transition-colors border-l-4 border-transparent"
                       :class="{'sidebar-active text-white bg-slate-800': activeTab === item.id}">
                        <i :class="item.icon + ' w-6 text-center text-lg'"></i>
                        <span class="ml-3 font-medium text-sm">{{ item.name }}</span>
                        <span v-if="item.badge && getBadgeCount(item.badge) > 0" class="ml-auto bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full">
                            {{ getBadgeCount(item.badge) }}
                        </span>
                    </a>
                </template>
            </nav>

            <div class="p-4 border-t border-slate-700">
                <button @click="logout" class="w-full flex items-center justify-center gap-2 p-3 rounded-lg bg-red-600/20 text-red-400 hover:bg-red-600 hover:text-white transition">
                    <i class="fa-solid fa-right-from-bracket"></i>
                    <span class="text-sm font-bold">Keluar</span>
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 flex flex-col h-full bg-gray-50 relative overflow-hidden w-full">
            <!-- Header Mobile / Title -->
            <header class="bg-white shadow-sm h-16 flex items-center justify-between px-4 lg:px-6 z-10 shrink-0">
                <div class="flex items-center gap-3">
                    <button @click="mobileMenuOpen = !mobileMenuOpen" class="lg:hidden text-slate-600 hover:text-blue-600 p-1">
                        <i class="fa-solid fa-bars text-xl"></i>
                    </button>
                    <h2 class="text-lg md:text-xl font-bold text-slate-800 truncate">
                        {{ currentTitle }}
                    </h2>
                </div>
                <div class="text-xs md:text-sm text-right hidden md:block">
                    <div class="font-semibold text-slate-800">{{ currentDate }}</div>
                </div>
            </header>

            <!-- Scrollable Content -->
            <div class="flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-6 scroll-smooth">
                
                <!-- === ADMIN: DASHBOARD === -->
                <div v-if="activeTab === 'dashboard' && currentUser.role === 'admin'" class="space-y-6">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex flex-col justify-between">
                            <div class="flex justify-between items-start mb-2"><p class="text-xs text-slate-500">Pending</p><div class="p-1.5 bg-orange-50 rounded-full text-orange-500"><i class="fa-solid fa-hourglass-half"></i></div></div>
                            <h3 class="text-2xl font-bold text-orange-600">{{ stats.pendingLoans }}</h3>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex flex-col justify-between">
                             <div class="flex justify-between items-start mb-2"><p class="text-xs text-slate-500">Dipinjam</p><div class="p-1.5 bg-blue-50 rounded-full text-blue-500"><i class="fa-solid fa-hand-holding"></i></div></div>
                            <h3 class="text-2xl font-bold text-blue-600">{{ stats.activeLoans }}</h3>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex flex-col justify-between">
                             <div class="flex justify-between items-start mb-2"><p class="text-xs text-slate-500">Aset</p><div class="p-1.5 bg-emerald-50 rounded-full text-emerald-500"><i class="fa-solid fa-boxes-stacked"></i></div></div>
                            <h3 class="text-2xl font-bold text-slate-800">{{ stats.totalItems }}</h3>
                        </div>
                         <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex flex-col justify-between">
                             <div class="flex justify-between items-start mb-2"><p class="text-xs text-slate-500">User</p><div class="p-1.5 bg-purple-50 rounded-full text-purple-500"><i class="fa-solid fa-users"></i></div></div>
                            <h3 class="text-2xl font-bold text-slate-800">{{ users.length }}</h3>
                        </div>
                    </div>
                     <!-- Charts Area -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-slate-100">
                            <h3 class="font-bold text-slate-700 mb-4 text-sm">Tren Peminjaman</h3>
                            <div class="h-64"><canvas id="loanChart"></canvas></div>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-slate-100">
                            <h3 class="font-bold text-slate-700 mb-4 text-sm">Status Aset</h3>
                            <div class="h-64 flex justify-center"><canvas id="categoryChart"></canvas></div>
                        </div>
                    </div>
                </div>

                <!-- === ADMIN: INVENTORY === -->
                <div v-if="activeTab === 'inventory' && currentUser.role === 'admin'" class="space-y-4">
                    <!-- Bulk Actions Toolbar -->
                    <div v-if="selectedInventoryIds.length > 0" class="bg-red-50 p-3 rounded-lg flex justify-between items-center border border-red-100 animate-[fadeIn_0.3s]">
                        <span class="text-sm text-red-700 font-bold ml-2">{{ selectedInventoryIds.length }} item dipilih</span>
                        <button @click="bulkDeleteInventory" class="px-3 py-1.5 bg-red-600 text-white rounded text-xs font-bold hover:bg-red-700 shadow-sm">
                            <i class="fa-solid fa-trash mr-1"></i> Hapus Terpilih
                        </button>
                    </div>

                    <div class="flex flex-col md:flex-row justify-between items-center gap-4 bg-white p-4 rounded-xl shadow-sm">
                        <div class="relative w-full md:w-auto md:flex-1">
                            <i class="fa-solid fa-search absolute left-3 top-3.5 text-slate-400"></i>
                            <input v-model="searchQuery" type="text" placeholder="Cari..." class="w-full pl-10 pr-4 py-3 bg-slate-50 rounded-lg text-sm border-none outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="flex gap-2 w-full md:w-auto justify-end">
                            <button @click="openItemModal()" class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium whitespace-nowrap"><i class="fa-solid fa-plus mr-1"></i> Baru</button>
                            <input type="file" ref="fileInput" @change="handleFileUpload" class="hidden" accept=".xlsx, .xls">
                            <button @click="$refs.fileInput.click()" class="px-3 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 text-sm font-medium whitespace-nowrap"><i class="fa-solid fa-file-import mr-1"></i> Import</button>
                            <button @click="downloadTemplate" class="px-3 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 text-sm font-medium whitespace-nowrap"><i class="fa-solid fa-download"></i></button>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-slate-100 table-responsive-wrapper">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm min-w-[600px]">
                                <thead class="bg-slate-50 text-slate-600 border-b">
                                    <tr>
                                        <th class="p-4 w-10">
                                            <input type="checkbox" :checked="isAllInventorySelected" @change="toggleAllInventory" class="custom-checkbox">
                                        </th>
                                        <th class="p-4">Kode</th><th class="p-4">Nama</th><th class="p-4">Lokasi</th><th class="p-4 text-center">Stok</th><th class="p-4 text-right">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-100">
                                    <tr v-for="item in filteredInventory" :key="item.id" class="hover:bg-slate-50 transition-colors" :class="{'bg-blue-50': selectedInventoryIds.includes(item.id)}">
                                        <td class="p-4">
                                            <input type="checkbox" v-model="selectedInventoryIds" :value="item.id" class="custom-checkbox">
                                        </td>
                                        <td class="p-4 font-mono text-slate-500">{{ item.code }}</td>
                                        <td class="p-4 font-bold text-slate-700">{{ item.name }} <span class="text-[10px] px-1.5 py-0.5 rounded ml-1" :class="item.type==='Alat'?'bg-blue-100 text-blue-600':'bg-orange-100 text-orange-600'">{{item.type}}</span></td>
                                        <td class="p-4 text-slate-500">{{ item.location }}</td>
                                        <td class="p-4 text-center" :class="{'text-red-500 font-bold': item.stock <= item.minStock}">{{ item.stock }} {{ item.unit }}</td>
                                        <td class="p-4 text-right">
                                            <button @click="openItemModal(item)" class="text-blue-600 hover:text-blue-800 mx-1"><i class="fa-solid fa-pen-to-square"></i></button>
                                            <button @click="deleteItem(item.id)" class="text-red-600 hover:text-red-800 mx-1"><i class="fa-solid fa-trash"></i></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- === ADMIN: LOAN APPROVALS === -->
                <div v-if="activeTab === 'approvals' && currentUser.role === 'admin'" class="space-y-4">
                     <!-- Bulk Actions Toolbar Loans -->
                     <div class="flex justify-between items-center mb-2">
                        <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide flex-1">
                            <button v-for="s in ['Pending', 'Dipinjam', 'Dikembalikan', 'Ditolak']" :key="s" 
                                @click="approvalFilter = s; selectedLoanIds = []" 
                                class="px-4 py-2 rounded-full text-sm font-medium border transition whitespace-nowrap flex-shrink-0"
                                :class="approvalFilter === s ? 'bg-slate-800 text-white' : 'bg-white text-slate-600'">
                                {{ s }} <span class="ml-1 text-[10px] bg-white/20 px-1.5 rounded-full">{{ loans.filter(l => l.status === s).length }}</span>
                            </button>
                        </div>
                        <!-- Select All Toggle -->
                        <div class="flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-slate-200 shadow-sm ml-2">
                            <input type="checkbox" :checked="isAllLoansSelected" @change="toggleAllLoans" id="selectAllLoans" class="custom-checkbox">
                            <label for="selectAllLoans" class="text-xs font-bold text-slate-600 cursor-pointer whitespace-nowrap">Pilih Semua</label>
                        </div>
                    </div>

                    <div v-if="selectedLoanIds.length > 0" class="bg-red-50 p-3 rounded-lg flex justify-between items-center border border-red-100 animate-[fadeIn_0.3s]">
                        <span class="text-sm text-red-700 font-bold ml-2">{{ selectedLoanIds.length }} data dipilih</span>
                        <button @click="bulkDeleteLoans" class="px-3 py-1.5 bg-red-600 text-white rounded text-xs font-bold hover:bg-red-700 shadow-sm">
                            <i class="fa-solid fa-trash mr-1"></i> Hapus Terpilih
                        </button>
                    </div>

                    <div class="grid gap-4">
                        <div v-for="loan in filteredLoansAdmin" :key="loan.id" 
                             class="bg-white p-4 md:p-5 rounded-xl shadow-sm border transition-all"
                             :class="selectedLoanIds.includes(loan.id) ? 'border-blue-500 ring-1 ring-blue-500 bg-blue-50' : 'border-slate-100'">
                            
                            <div class="flex justify-between items-start mb-4 pb-4 border-b border-slate-200/60 gap-2">
                                <div class="flex items-start gap-3">
                                    <input type="checkbox" v-model="selectedLoanIds" :value="loan.id" class="custom-checkbox mt-1">
                                    <div>
                                        <h4 class="font-bold text-lg text-slate-800">{{ loan.borrowerName }}</h4>
                                        <p class="text-sm text-slate-500">{{ loan.borrowerNim }}</p>
                                    </div>
                                </div>
                                <span class="px-3 py-1 rounded-full text-xs font-bold self-start md:self-auto" 
                                    :class="getStatusColor(loan.status)">{{ loan.status }}</span>
                            </div>
                            <div class="mb-4 pl-7">
                                <p class="text-xs font-bold text-slate-400 uppercase mb-1">Jadwal</p>
                                <p class="text-sm text-slate-700"><i class="fa-regular fa-calendar mr-2"></i> {{formatDate(loan.startDate)}} s.d {{formatDate(loan.endDate)}}</p>
                                <p class="text-sm text-slate-700 mt-1"><i class="fa-solid fa-circle-info mr-2"></i> {{ loan.purpose }}</p>
                            </div>
                            <div class="bg-slate-50 p-3 rounded-lg mb-4 ml-7">
                                <div v-for="item in loan.items" :key="item.id" class="flex justify-between text-sm py-1 border-b border-slate-200 last:border-0">
                                    <span>{{ item.name }}</span>
                                    <span class="font-bold">x{{ item.qty }}</span>
                                </div>
                            </div>
                            <div class="flex flex-wrap justify-end gap-2 mt-2 ml-7">
                                <button v-if="loan.status === 'Pending'" @click="rejectLoan(loan.id)" class="px-4 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 text-sm font-bold flex-1 md:flex-none">Tolak</button>
                                <button v-if="loan.status === 'Pending'" @click="approveLoan(loan.id)" class="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 text-sm font-bold shadow-lg shadow-emerald-500/20 flex-1 md:flex-none">Setujui</button>
                                <button v-if="['Dipinjam', 'Dikembalikan'].includes(loan.status)" @click="printLetter(loan)" class="px-4 py-2 border border-slate-200 text-slate-600 rounded-lg hover:border-blue-500 hover:text-blue-600 text-sm flex-1 md:flex-none"><i class="fa-solid fa-print"></i> Surat</button>
                                <button v-if="loan.status === 'Dipinjam'" @click="openReturnModal(loan)" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-bold flex-1 md:flex-none">Proses Kembali</button>
                            </div>
                        </div>
                         <div v-if="filteredLoansAdmin.length === 0" class="text-center py-12 text-slate-400">Tidak ada data {{ approvalFilter }}.</div>
                    </div>
                </div>

                <!-- === ADMIN: TRASH / RESTORE === -->
                <div v-if="activeTab === 'trash' && currentUser.role === 'admin'" class="space-y-6">
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                        <div class="flex gap-4 border-b border-slate-100 pb-2 mb-4">
                            <button @click="trashTab = 'inventory'" class="pb-2 text-sm font-bold transition-colors" :class="trashTab==='inventory' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-500'">Inventaris ({{deletedInventory.length}})</button>
                            <button @click="trashTab = 'loans'" class="pb-2 text-sm font-bold transition-colors" :class="trashTab==='loans' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-500'">Peminjaman ({{deletedLoans.length}})</button>
                        </div>

                        <!-- Trash: Inventory -->
                        <div v-if="trashTab === 'inventory'">
                            <div v-if="deletedInventory.length === 0" class="text-center py-10 text-slate-400 text-sm">Tempat sampah kosong.</div>
                            <div v-else class="space-y-3">
                                <div v-for="item in deletedInventory" :key="item.id" class="flex justify-between items-center p-3 bg-red-50/50 border border-red-100 rounded-lg">
                                    <div>
                                        <p class="font-bold text-slate-800 text-sm">{{ item.name }} ({{ item.code }})</p>
                                        <p class="text-xs text-slate-500">Dihapus: {{ item.deletedAt ? formatDate(item.deletedAt) : '-' }}</p>
                                    </div>
                                    <div class="flex gap-2">
                                        <button @click="restoreItem(item)" class="px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded text-xs font-bold hover:bg-emerald-200">Restore</button>
                                        <button @click="permanentDeleteItem(item.id)" class="px-3 py-1.5 bg-red-600 text-white rounded text-xs font-bold hover:bg-red-700">Hapus Permanen</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                         <!-- Trash: Loans -->
                         <div v-if="trashTab === 'loans'">
                            <div v-if="deletedLoans.length === 0" class="text-center py-10 text-slate-400 text-sm">Tempat sampah kosong.</div>
                            <div v-else class="space-y-3">
                                <div v-for="loan in deletedLoans" :key="loan.id" class="flex flex-col md:flex-row justify-between md:items-center p-3 bg-red-50/50 border border-red-100 rounded-lg gap-2">
                                    <div>
                                        <p class="font-bold text-slate-800 text-sm">{{ loan.borrowerName }} - {{ loan.borrowerNim }}</p>
                                        <span class="text-xs px-2 py-0.5 rounded bg-white border border-slate-200">{{ loan.status }}</span>
                                        <p class="text-xs text-slate-500 mt-1">Item: {{ loan.items.map(i=>i.name).join(', ') }}</p>
                                    </div>
                                    <div class="flex gap-2 self-end md:self-auto">
                                        <button @click="restoreLoan(loan)" class="px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded text-xs font-bold hover:bg-emerald-200">Restore</button>
                                        <button @click="permanentDeleteLoan(loan.id)" class="px-3 py-1.5 bg-red-600 text-white rounded text-xs font-bold hover:bg-red-700">Hapus Permanen</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- === ADMIN: SETTINGS === -->
                <div v-if="activeTab === 'settings' && currentUser.role === 'admin'" class="max-w-4xl mx-auto bg-white p-4 md:p-6 rounded-xl shadow-sm border border-slate-100">
                     <!-- Settings content same as before -->
                     <h3 class="text-lg font-bold text-slate-800 border-b pb-4 mb-4">Pengaturan Kop Surat & Admin</h3>
                     <div class="mb-6 bg-blue-50 p-4 rounded-lg border border-blue-100">
                         <h4 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                             <i class="fa-solid fa-image"></i> Logo & Kontak
                         </h4>
                         <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                             <div class="md:col-span-1 flex flex-col items-center">
                                 <div class="w-24 h-24 md:w-32 md:h-32 border-2 border-dashed border-slate-300 rounded-lg flex items-center justify-center bg-white overflow-hidden mb-2 relative group">
                                     <img v-if="settings.logo" :src="settings.logo" class="w-full h-full object-contain">
                                     <div v-else class="text-slate-400 text-center text-xs">
                                         <i class="fa-solid fa-upload text-xl mb-1 block"></i> Upload
                                     </div>
                                     <input type="file" accept="image/*" @change="handleLogoUpload" class="absolute inset-0 opacity-0 cursor-pointer">
                                     <button v-if="settings.logo" @click.stop="removeLogo" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 text-xs w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition"><i class="fa-solid fa-times"></i></button>
                                 </div>
                             </div>
                             <div class="md:col-span-2 grid grid-cols-1 gap-4">
                                 <div><label class="block text-sm font-medium mb-1">No. Telepon</label><input v-model="settings.phone" placeholder="(061) 123456" class="w-full border p-2 rounded text-sm bg-white"></div>
                                 <div><label class="block text-sm font-medium mb-1">Fax</label><input v-model="settings.fax" placeholder="(061) 654321" class="w-full border p-2 rounded text-sm bg-white"></div>
                                 <div><label class="block text-sm font-medium mb-1">Email</label><input v-model="settings.email" placeholder="lab@universitas.ac.id" class="w-full border p-2 rounded text-sm bg-white"></div>
                             </div>
                         </div>
                     </div>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                        <div class="col-span-1 md:col-span-2"><label class="block text-sm font-medium mb-1 text-blue-800">Nama Kementerian</label><input v-model="settings.ministryName" class="w-full border p-2 rounded text-sm bg-blue-50/50"></div>
                        <div><label class="block text-sm font-medium mb-1">Institusi / Universitas</label><input v-model="settings.universityName" class="w-full border p-2 rounded text-sm"></div>
                        <div><label class="block text-sm font-medium mb-1">Fakultas</label><input v-model="settings.facultyName" class="w-full border p-2 rounded text-sm"></div>
                        <div class="col-span-1 md:col-span-2"><label class="block text-sm font-medium mb-1">Alamat Lengkap</label><textarea v-model="settings.address" rows="2" class="w-full border p-2 rounded text-sm"></textarea></div>
                        <div class="col-span-1 md:col-span-2"><label class="block text-sm font-medium mb-1">Kota</label><input v-model="settings.city" class="w-full border p-2 rounded text-sm"></div>
                        <div class="col-span-1 md:col-span-2 bg-slate-50 p-4 rounded border border-slate-200">
                             <h4 class="font-bold text-sm text-slate-700 mb-2">Format Surat</h4>
                             <label class="block text-xs font-medium mb-1 text-slate-500">Kode Surat</label>
                             <input v-model="settings.letterCode" class="w-full border p-2 rounded text-sm" placeholder="/LAB/2024">
                        </div>
                        <div><label class="block text-sm font-medium mb-1">Nama Kepala Lab</label><input v-model="settings.headLabName" class="w-full border p-2 rounded text-sm"></div>
                        <div><label class="block text-sm font-medium mb-1">NIP Kepala Lab</label><input v-model="settings.headLabNip" class="w-full border p-2 rounded text-sm"></div>
                     </div>
                     <div class="mt-6 flex justify-end"><button @click="saveSettings" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold text-sm">Simpan</button></div>
                </div>

                <!-- Client Tabs (unchanged logic, just kept in structure) -->
                <div v-if="activeTab === 'catalog' && currentUser.role === 'client'" class="flex flex-col lg:flex-row gap-6 h-full">
                    <!-- Client Catalog Logic (as is) -->
                     <div class="flex-1 flex flex-col gap-4 overflow-hidden h-full">
                        <div class="bg-white p-4 rounded-xl shadow-sm flex gap-2 flex-col md:flex-row shrink-0">
                             <div class="relative flex-1">
                                <i class="fa-solid fa-search absolute left-3 top-3.5 text-slate-400"></i>
                                <input v-model="posSearch" type="text" placeholder="Cari alat..." class="w-full pl-10 pr-4 py-3 bg-slate-50 border-none rounded-lg outline-none text-sm">
                            </div>
                             <select v-model="posFilter" class="bg-slate-50 rounded-lg px-3 py-3 md:py-0 text-sm border-none outline-none"><option value="">Semua</option><option value="Alat">Alat</option><option value="Bahan">Bahan</option></select>
                        </div>
                        <div class="flex-1 overflow-y-auto pr-2 grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 content-start pb-40 lg:pb-0">
                             <div v-for="item in filteredPosItems" :key="item.id" @click="addToCart(item)"
                                class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 cursor-pointer hover:border-blue-500 hover:shadow-md transition group relative overflow-hidden h-fit">
                                <div class="absolute top-2 right-2 px-2 py-0.5 rounded text-[10px] font-bold" :class="item.type==='Alat'?'bg-blue-100 text-blue-600':'bg-orange-100 text-orange-600'">{{ item.type }}</div>
                                <div class="h-12 w-12 bg-slate-100 rounded-lg flex items-center justify-center mb-3 text-slate-500 group-hover:bg-blue-50 group-hover:text-blue-600 transition"><i class="fa-solid" :class="item.type==='Alat' ? 'fa-microscope' : 'fa-flask'"></i></div>
                                <h4 class="font-bold text-slate-800 text-sm line-clamp-2">{{ item.name }}</h4>
                                <div class="flex justify-between items-end mt-2"><span class="text-xs text-slate-500">{{ item.location }}</span><span class="text-sm font-bold text-emerald-600">Stok: {{ item.stock }}</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="fixed bottom-0 left-0 right-0 z-40 lg:static lg:z-0 w-full lg:w-80 flex flex-col bg-white rounded-t-2xl lg:rounded-xl shadow-[0_-5px_20px_rgba(0,0,0,0.1)] lg:shadow-lg border border-slate-200 overflow-hidden lg:h-full transition-transform duration-300"
                         :class="{'translate-y-[calc(100%-60px)] lg:translate-y-0': cartCollapsed && isMobile, 'translate-y-0': !cartCollapsed || !isMobile}">
                        <div @click="isMobile ? cartCollapsed = !cartCollapsed : null" class="p-4 bg-slate-900 text-white flex justify-between items-center cursor-pointer lg:cursor-default">
                            <div class="flex items-center gap-2">
                                <i class="fa-solid fa-angle-up lg:hidden transition-transform" :class="{'rotate-180': !cartCollapsed}"></i>
                                <h3 class="font-bold text-sm">Keranjang Pinjam</h3>
                            </div>
                            <span class="bg-blue-600 px-2 rounded text-xs">{{cart.length}} Item</span>
                        </div>
                        <div class="flex-1 overflow-y-auto p-4 space-y-3 bg-slate-50 max-h-[300px] lg:max-h-none">
                            <div v-if="cart.length === 0" class="h-32 lg:h-full flex flex-col items-center justify-center text-slate-400 text-center opacity-60"><i class="fa-solid fa-basket-shopping text-3xl mb-2"></i><p class="text-xs">Pilih barang</p></div>
                            <div v-for="(item, idx) in cart" :key="idx" class="bg-white p-3 rounded border flex justify-between items-center">
                                <div class="flex-1 overflow-hidden"><h4 class="font-bold text-xs truncate">{{ item.name }}</h4></div>
                                <div class="flex items-center gap-1 ml-2"><button @click="updateCartQty(idx, -1)" class="w-6 h-6 bg-slate-100 rounded text-xs">-</button><span class="w-6 text-center text-xs font-bold">{{item.qty}}</span><button @click="updateCartQty(idx, 1)" class="w-6 h-6 bg-slate-100 rounded text-xs">+</button><button @click="removeFromCart(idx)" class="ml-1 text-red-500 text-xs"><i class="fa-solid fa-times"></i></button></div>
                            </div>
                        </div>
                        <div class="p-4 bg-white border-t space-y-3 pb-8 lg:pb-4">
                            <div><label class="text-[10px] font-bold text-slate-500 uppercase">Tanggal</label><div class="flex gap-2"><input v-model="loanDate" type="date" class="w-1/2 border rounded p-1.5 text-xs"><input v-model="returnDate" type="date" class="w-1/2 border rounded p-1.5 text-xs"></div></div>
                            <div><label class="text-[10px] font-bold text-slate-500 uppercase">Keperluan</label><textarea v-model="loanPurpose" rows="2" class="w-full border rounded p-2 text-xs resize-none" placeholder="Praktikum..."></textarea></div>
                            <button @click="submitLoanRequest" :disabled="cart.length===0" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 rounded text-sm disabled:bg-slate-300">Ajukan Peminjaman</button>
                        </div>
                    </div>
                </div>

                <div v-if="activeTab === 'dashboard' && currentUser.role === 'client'" class="space-y-6">
                     <!-- Client Dashboard Logic (as is) -->
                     <div class="bg-blue-600 rounded-xl p-6 text-white shadow-lg relative overflow-hidden">
                        <div class="absolute right-0 top-0 w-64 h-64 bg-white/10 rounded-full -mr-16 -mt-16 blur-3xl"></div>
                        <div class="relative z-10">
                            <h3 class="text-2xl font-bold mb-1">Halo, {{ currentUser.name }}!</h3>
                            <p class="text-blue-100 text-sm">Selamat datang di panel peminjaman laboratorium.</p>
                            <div class="mt-6 flex gap-3">
                                <button @click="navigate('catalog')" class="bg-white text-blue-600 px-4 py-2 rounded-lg font-bold text-sm hover:bg-blue-50 transition shadow-lg">Ajukan Peminjaman</button>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100">
                            <div class="flex justify-between items-center mb-2"><span class="text-xs text-slate-500 font-bold">SEDANG DIPINJAM</span><i class="fa-solid fa-clock text-blue-500 bg-blue-50 p-2 rounded-full"></i></div>
                            <h3 class="text-3xl font-bold text-slate-800">{{ clientStats.active }}</h3>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100">
                            <div class="flex justify-between items-center mb-2"><span class="text-xs text-slate-500 font-bold">MENUNGGU</span><i class="fa-solid fa-hourglass text-orange-500 bg-orange-50 p-2 rounded-full"></i></div>
                            <h3 class="text-3xl font-bold text-slate-800">{{ clientStats.pending }}</h3>
                        </div>
                         <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 col-span-2 md:col-span-1">
                            <div class="flex justify-between items-center mb-2"><span class="text-xs text-slate-500 font-bold">TOTAL RIWAYAT</span><i class="fa-solid fa-history text-emerald-500 bg-emerald-50 p-2 rounded-full"></i></div>
                            <h3 class="text-3xl font-bold text-slate-800">{{ clientStats.total }}</h3>
                        </div>
                    </div>
                </div>

                <div v-if="activeTab === 'history' && currentUser.role === 'client'" class="space-y-4">
                     <!-- Client History (as is) -->
                     <h3 class="font-bold text-slate-800 text-lg">Riwayat Peminjaman Saya</h3>
                    <div class="grid gap-4">
                        <div v-for="loan in myLoans" :key="loan.id" class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 relative overflow-hidden">
                             <div class="absolute left-0 top-0 bottom-0 w-1" :class="getStatusColorBorder(loan.status)"></div>
                             <div class="flex flex-col md:flex-row justify-between items-start mb-2 gap-2">
                                <div>
                                    <span class="text-xs text-slate-500 block mb-1">ID: {{ loan.id }}</span>
                                    <span class="px-2 py-0.5 rounded text-xs font-bold border" :class="getStatusColor(loan.status)">{{ loan.status }}</span>
                                </div>
                                <div class="text-left md:text-right text-xs text-slate-500">
                                    <p>Tgl Pinjam: {{ formatDate(loan.startDate) }}</p>
                                    <p>Tgl Kembali: {{ formatDate(loan.endDate) }}</p>
                                </div>
                             </div>
                             <div class="mt-3 pt-3 border-t border-slate-100 flex flex-col gap-3">
                                 <div>
                                    <p class="text-xs font-bold text-slate-600 mb-1">Barang:</p>
                                    <div class="flex flex-wrap gap-2">
                                        <span v-for="item in loan.items" class="bg-slate-100 text-slate-700 px-2 py-1 rounded text-xs border border-slate-200">
                                            {{ item.name }} ({{ item.qty }})
                                        </span>
                                    </div>
                                 </div>
                                 <div v-if="['Dipinjam', 'Dikembalikan'].includes(loan.status)" class="flex justify-end border-t border-dashed border-slate-200 pt-2">
                                     <button @click="printLetter(loan)" class="px-3 py-1.5 bg-blue-50 text-blue-600 text-xs font-bold rounded hover:bg-blue-100 transition flex items-center gap-2">
                                         <i class="fa-solid fa-print"></i> Cetak Surat Izin
                                     </button>
                                 </div>
                             </div>
                        </div>
                        <div v-if="myLoans.length === 0" class="text-center py-12 bg-white rounded-xl text-slate-400">Belum ada riwayat peminjaman.</div>
                    </div>
                </div>

                <div v-if="activeTab === 'client_settings' && currentUser.role === 'client'" class="max-w-xl mx-auto bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                    <!-- Client Settings -->
                     <h3 class="text-lg font-bold text-slate-800 border-b pb-4 mb-4">Pengaturan Profil</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-medium mb-1">Nama Lengkap</label><input v-model="clientForm.name" type="text" class="w-full border p-2.5 rounded text-sm bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none"></div>
                        <div><label class="block text-sm font-medium mb-1">NIM / NIP / NIDN</label><input v-model="clientForm.nim" type="text" class="w-full border p-2.5 rounded text-sm bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none"></div>
                        <div><label class="block text-sm font-medium mb-1">Username</label><input v-model="clientForm.username" type="text" class="w-full border p-2.5 rounded text-sm bg-slate-100 text-slate-500 cursor-not-allowed" disabled></div>
                        <div><label class="block text-sm font-medium mb-1">Password</label><div class="relative"><input v-model="clientForm.password" :type="showPass ? 'text' : 'password'" class="w-full border p-2.5 rounded text-sm bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none"><button @click="showPass = !showPass" class="absolute right-3 top-2.5 text-slate-400 hover:text-blue-600"><i class="fa-solid" :class="showPass ? 'fa-eye-slash' : 'fa-eye'"></i></button></div></div>
                    </div>
                    <div class="mt-8 flex justify-end"><button @click="saveClientProfile" class="px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold text-sm shadow-lg shadow-blue-500/20 transition-all active:scale-95"><i class="fa-solid fa-save mr-1"></i> Simpan Perubahan</button></div>
                </div>

            </div>
        </main>
    </div>

    <!-- MODALS -->
    <!-- Item Modal (Admin) -->
    <div v-if="modals.item" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-6 space-y-4">
            <h3 class="font-bold text-lg border-b pb-2">{{ editingItem ? 'Edit Barang' : 'Tambah Barang' }}</h3>
            <div class="grid grid-cols-2 gap-4">
                <div class="col-span-1"><input v-model="itemForm.code" placeholder="Kode" class="w-full border p-2 rounded text-sm"></div>
                <div class="col-span-1"><input v-model="itemForm.name" placeholder="Nama Barang" class="w-full border p-2 rounded text-sm"></div>
                <div class="col-span-1"><select v-model="itemForm.type" class="w-full border p-2 rounded text-sm"><option value="Alat">Alat</option><option value="Bahan">Bahan</option></select></div>
                <div class="col-span-1"><input v-model.number="itemForm.stock" type="number" placeholder="Stok" class="w-full border p-2 rounded text-sm"></div>
                <div class="col-span-1"><input v-model="itemForm.unit" placeholder="Satuan (Pcs/ml)" class="w-full border p-2 rounded text-sm"></div>
                <div class="col-span-1"><input v-model="itemForm.location" placeholder="Lokasi Rak" class="w-full border p-2 rounded text-sm"></div>
            </div>
            <div class="flex justify-end gap-2 pt-2">
                <button @click="modals.item=false" class="px-4 py-2 text-slate-500 text-sm">Batal</button>
                <button @click="saveItem" class="px-4 py-2 bg-blue-600 text-white rounded text-sm font-bold">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Return Modal (Admin) -->
    <div v-if="modals.return && selectedLoan" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-xl p-6">
            <h3 class="font-bold text-lg mb-4 text-blue-600">Proses Pengembalian</h3>
            <div class="space-y-3 mb-4 max-h-60 overflow-y-auto bg-slate-50 p-3 rounded">
                <div v-for="item in returnItemsState" :key="item.id" class="flex justify-between items-center text-sm border-b last:border-0 pb-2">
                    <span>{{ item.name }} ({{ item.qty }})</span>
                    <select v-if="item.type==='Alat'" v-model="item.condition" class="border rounded p-1 text-xs"><option value="Baik">Baik</option><option value="Rusak">Rusak</option><option value="Hilang">Hilang</option></select>
                    <span v-else class="text-xs text-orange-500 italic">Habis Pakai</span>
                </div>
            </div>
            <textarea v-model="returnNote" placeholder="Catatan / Denda..." class="w-full border p-2 rounded text-sm h-20 mb-4"></textarea>
            <div class="flex justify-end gap-2">
                <button @click="modals.return=false" class="px-4 py-2 text-slate-500 text-sm">Batal</button>
                <button @click="confirmReturn" class="px-4 py-2 bg-emerald-600 text-white rounded text-sm font-bold">Selesai</button>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;
    const { jsPDF } = window.jspdf;

    createApp({
        setup() {
            // --- AUTHENTICATION ---
            const users = ref([]);
            const currentUser = ref(null);
            const authMode = ref('login');
            const authForm = ref({ name: '', username: '', password: '', role: 'client', nim: '' });

            // --- APP STATE ---
            const sidebarCollapsed = ref(false);
            const mobileMenuOpen = ref(false); 
            const activeTab = ref('dashboard');
            const trashTab = ref('inventory'); // For Restore Menu
            const currentDate = ref('');
            const isMobile = ref(window.innerWidth < 1024);
            
            // --- DATA ---
            const inventory = ref([]);
            const deletedInventory = ref([]); // Trash for inventory
            const loans = ref([]);
            const deletedLoans = ref([]); // Trash for loans
            const cart = ref([]);
            const cartCollapsed = ref(true); 
            const settings = ref({
                ministryName: 'KEMENTERIAN PENDIDIKAN, KEBUDAYAAN, RISET, DAN TEKNOLOGI',
                universityName: 'UNIVERSITAS INDONESIA MAJU',
                facultyName: 'FAKULTAS SAINS DAN TEKNOLOGI',
                address: 'Jl. Jendral Sudirman No. 123, Medan',
                city: 'Medan',
                phone: '(061) 123456',
                fax: '(061) 123457',
                email: 'saintek@universitas.ac.id',
                headLabName: 'Dr. Budi Santoso',
                headLabNip: '19800101',
                logo: null, 
                letterCode: '/LAB/2024'
            });

            // --- UI HELPERS ---
            const searchQuery = ref("");
            const posSearch = ref("");
            const posFilter = ref("");
            const approvalFilter = ref("Pending");
            const modals = ref({ item: false, return: false });
            const itemForm = ref({});
            const editingItem = ref(false);
            const loanDate = ref(new Date().toISOString().split('T')[0]);
            const returnDate = ref(new Date().toISOString().split('T')[0]);
            const loanPurpose = ref("");
            const selectedLoan = ref(null);
            const returnItemsState = ref([]);
            const returnNote = ref("");
            
            // --- SELECTION STATE (NEW) ---
            const selectedInventoryIds = ref([]);
            const selectedLoanIds = ref([]);

            // Client Settings Helper
            const clientForm = ref({});
            const showPass = ref(false);

            window.addEventListener('resize', () => {
                isMobile.value = window.innerWidth < 1024;
            });

            // --- COMPUTED ---
            const currentMenuItems = computed(() => {
                if (!currentUser.value) return [];
                if (currentUser.value.role === 'admin') {
                    return [
                        { id: 'dashboard', name: 'Dashboard', icon: 'fa-solid fa-chart-line' },
                        { id: 'approvals', name: 'Peminjaman', icon: 'fa-solid fa-clipboard-check', badge: 'pendingLoans' },
                        { id: 'inventory', name: 'Inventaris', icon: 'fa-solid fa-boxes-stacked' },
                        { id: 'trash', name: 'Sampah / Restore', icon: 'fa-solid fa-trash-arrow-up' },
                        { id: 'settings', name: 'Pengaturan', icon: 'fa-solid fa-gear' },
                    ];
                } else {
                    return [
                        { id: 'dashboard', name: 'Dashboard', icon: 'fa-solid fa-home' },
                        { id: 'catalog', name: 'Katalog Alat', icon: 'fa-solid fa-search' },
                        { id: 'history', name: 'Riwayat Saya', icon: 'fa-solid fa-clock-rotate-left' },
                        { id: 'client_settings', name: 'Profil Saya', icon: 'fa-solid fa-user-gear' },
                    ];
                }
            });

            const currentTitle = computed(() => {
                const map = { 
                    dashboard: currentUser.value?.role === 'admin' ? 'Dashboard Admin' : 'Dashboard Client', 
                    approvals: 'Data Peminjaman', 
                    inventory: 'Inventaris', 
                    trash: 'Sampah & Restore',
                    catalog: 'Katalog', 
                    history: 'Riwayat',
                    client_settings: 'Profil',
                    settings: 'Pengaturan'
                };
                return map[activeTab.value] || 'Aplikasi';
            });

            const filteredInventory = computed(() => inventory.value.filter(i => i.name.toLowerCase().includes(searchQuery.value.toLowerCase())));
            
            // Checkbox Logic Inventory
            const isAllInventorySelected = computed(() => {
                return filteredInventory.value.length > 0 && selectedInventoryIds.value.length === filteredInventory.value.length;
            });
            
            const toggleAllInventory = (e) => {
                if(e.target.checked) {
                    selectedInventoryIds.value = filteredInventory.value.map(i => i.id);
                } else {
                    selectedInventoryIds.value = [];
                }
            };

            const filteredPosItems = computed(() => inventory.value.filter(i => {
                return i.name.toLowerCase().includes(posSearch.value.toLowerCase()) && 
                       (posFilter.value ? i.type === posFilter.value : true) &&
                       i.stock > 0;
            }));

            const filteredLoansAdmin = computed(() => loans.value.filter(l => l.status === approvalFilter.value).sort((a,b) => new Date(b.created) - new Date(a.created)));
            
            // Checkbox Logic Loans
             const isAllLoansSelected = computed(() => {
                return filteredLoansAdmin.value.length > 0 && selectedLoanIds.value.length === filteredLoansAdmin.value.length;
            });

            const toggleAllLoans = (e) => {
                if(e.target.checked) {
                    selectedLoanIds.value = filteredLoansAdmin.value.map(l => l.id);
                } else {
                    selectedLoanIds.value = [];
                }
            };

            const myLoans = computed(() => loans.value.filter(l => l.borrowerId === currentUser.value.id).sort((a,b) => new Date(b.created) - new Date(a.created)));

            const stats = computed(() => ({
                pendingLoans: loans.value.filter(l => l.status === 'Pending').length,
                activeLoans: loans.value.filter(l => l.status === 'Dipinjam').length,
                totalItems: inventory.value.length
            }));

            const clientStats = computed(() => {
                const my = myLoans.value;
                return {
                    active: my.filter(l => l.status === 'Dipinjam').length,
                    pending: my.filter(l => l.status === 'Pending').length,
                    total: my.length
                };
            });

            const getBadgeCount = (key) => key === 'pendingLoans' ? stats.value.pendingLoans : 0;

            // --- INVENTORY CRUD & SOFT DELETE ---
            const openItemModal = (item=null) => {
                editingItem.value = !!item;
                itemForm.value = item ? {...item} : { id: Date.now(), code: '', name: '', type: 'Alat', stock: 0, unit: 'Pcs', location: '-', minStock: 2 };
                modals.value.item = true;
            };

            const saveItem = () => {
                if(editingItem.value) Object.assign(inventory.value.find(i=>i.id===itemForm.value.id), itemForm.value);
                else inventory.value.push(itemForm.value);
                saveData();
                modals.value.item = false;
            };

            const deleteItem = (id) => {
                if(confirm('Pindahkan item ini ke sampah?')) { 
                    const item = inventory.value.find(i=>i.id===id);
                    if(item) {
                        item.deletedAt = new Date().toISOString();
                        deletedInventory.value.push(item);
                        inventory.value = inventory.value.filter(i=>i.id!==id);
                        saveData();
                        Swal.fire('Terhapus', 'Item dipindahkan ke menu Sampah', 'success');
                    }
                }
            };

            const bulkDeleteInventory = () => {
                if(confirm(`Hapus ${selectedInventoryIds.value.length} item terpilih ke sampah?`)) {
                    selectedInventoryIds.value.forEach(id => {
                        const item = inventory.value.find(i=>i.id===id);
                        if(item) {
                            item.deletedAt = new Date().toISOString();
                            deletedInventory.value.push(item);
                        }
                    });
                    inventory.value = inventory.value.filter(i => !selectedInventoryIds.value.includes(i.id));
                    selectedInventoryIds.value = [];
                    saveData();
                    Swal.fire('Sukses', 'Item terpilih dipindahkan ke Sampah', 'success');
                }
            };

            // --- LOANS CRUD & SOFT DELETE ---
            const deleteLoanById = (id, silent=false) => {
                const loan = loans.value.find(l => l.id === id);
                if(loan) {
                    loan.deletedAt = new Date().toISOString();
                    deletedLoans.value.push(loan);
                    loans.value = loans.value.filter(l => l.id !== id);
                    if(!silent) saveData();
                }
            };

            const bulkDeleteLoans = () => {
                 if(confirm(`Hapus ${selectedLoanIds.value.length} data peminjaman terpilih ke sampah?`)) {
                    selectedLoanIds.value.forEach(id => deleteLoanById(id, true));
                    saveData();
                    selectedLoanIds.value = [];
                    Swal.fire('Sukses', 'Data peminjaman dipindahkan ke Sampah', 'success');
                 }
            };

            // --- RESTORE & PERMANENT DELETE ---
            const restoreItem = (item) => {
                delete item.deletedAt;
                inventory.value.push(item);
                deletedInventory.value = deletedInventory.value.filter(i => i.id !== item.id);
                saveData();
                Swal.fire('Dipulihkan', 'Item kembali ke inventaris', 'success');
            };

            const permanentDeleteItem = (id) => {
                if(confirm('Hapus permanen? Data tidak bisa kembali.')) {
                    deletedInventory.value = deletedInventory.value.filter(i => i.id !== id);
                    saveData();
                }
            };

            const restoreLoan = (loan) => {
                delete loan.deletedAt;
                loans.value.push(loan);
                deletedLoans.value = deletedLoans.value.filter(l => l.id !== loan.id);
                saveData();
                Swal.fire('Dipulihkan', 'Data peminjaman dikembalikan', 'success');
            };

            const permanentDeleteLoan = (id) => {
                if(confirm('Hapus permanen? Data tidak bisa kembali.')) {
                    deletedLoans.value = deletedLoans.value.filter(l => l.id !== id);
                    saveData();
                }
            };

            // --- AUTH & OTHER LOGIC ---
            const handleAuth = () => {
                if (authMode.value === 'login') {
                    const user = users.value.find(u => u.username === authForm.value.username && u.password === authForm.value.password);
                    if (user) {
                        loginUser(user);
                    } else {
                        Swal.fire('Error', 'Username/Password salah', 'error');
                    }
                } else {
                    if (users.value.find(u => u.username === authForm.value.username)) return Swal.fire('Error', 'Username ada', 'warning');
                    const newUser = { ...authForm.value, id: 'U-' + Date.now() };
                    users.value.push(newUser);
                    saveData();
                    Swal.fire('Sukses', 'Registrasi berhasil. Silakan login.', 'success');
                    authMode.value = 'login';
                }
            };

            const loginUser = (user) => {
                currentUser.value = user;
                localStorage.setItem('sl_current_user', JSON.stringify(user));
                activeTab.value = 'dashboard'; 
                nextTick(() => { if(user.role === 'admin') renderCharts(); });
                if(user.role === 'client') {
                    clientForm.value = { ...user };
                }
            };

            const logout = () => {
                currentUser.value = null;
                localStorage.removeItem('sl_current_user');
                authForm.value = { name: '', username: '', password: '', role: 'client', nim: '' };
                mobileMenuOpen.value = false;
            };

            const navigate = (tabId) => {
                activeTab.value = tabId;
                mobileMenuOpen.value = false;
            };

            const approveLoan = (id) => {
                const loan = loans.value.find(l => l.id === id);
                let possible = true;
                loan.items.forEach(reqItem => {
                    const invItem = inventory.value.find(i => i.id === reqItem.id);
                    if (!invItem || invItem.stock < reqItem.qty) possible = false;
                });
                if (!possible) return Swal.fire('Gagal', 'Stok tidak mencukupi saat ini', 'error');
                loan.items.forEach(reqItem => {
                    const invItem = inventory.value.find(i => i.id === reqItem.id);
                    invItem.stock -= reqItem.qty;
                });
                loan.status = 'Dipinjam';
                saveData();
                Swal.fire({
                    title: 'Disetujui',
                    text: 'Status diubah menjadi Dipinjam.',
                    icon: 'success',
                    showCancelButton: true,
                    confirmButtonText: 'Cetak Surat'
                }).then((res) => { if(res.isConfirmed) printLetter(loan); });
            };

            const rejectLoan = (id) => {
                const loan = loans.value.find(l => l.id === id);
                loan.status = 'Ditolak';
                saveData();
            };

            const openReturnModal = (loan) => {
                selectedLoan.value = loan;
                returnItemsState.value = loan.items.map(i => ({...i, condition: 'Baik'}));
                modals.value.return = true;
            };

            const confirmReturn = () => {
                returnItemsState.value.forEach(rItem => {
                    if (rItem.type === 'Alat' && rItem.condition === 'Baik') {
                        const invItem = inventory.value.find(i => i.id === rItem.id);
                        if(invItem) invItem.stock += rItem.qty;
                    }
                });
                const loan = loans.value.find(l => l.id === selectedLoan.value.id);
                loan.status = 'Dikembalikan';
                loan.returnNote = returnNote.value;
                loan.returnDateActual = new Date().toISOString();
                saveData();
                modals.value.return = false;
                Swal.fire('Berhasil', 'Pengembalian diproses', 'success');
            };

            const addToCart = (item) => {
                const exist = cart.value.find(c => c.id === item.id);
                if (exist) {
                    if (exist.qty < item.stock) exist.qty++;
                    else Swal.fire('Limit', 'Stok terbatas', 'warning');
                } else {
                    cart.value.push({ ...item, qty: 1 });
                    cartCollapsed.value = false;
                }
            };

            const updateCartQty = (idx, v) => {
                const c = cart.value[idx];
                const inv = inventory.value.find(i => i.id === c.id);
                const n = c.qty + v;
                if (n > 0 && n <= inv.stock) c.qty = n;
            };

            const removeFromCart = (idx) => cart.value.splice(idx, 1);

            const submitLoanRequest = () => {
                if(!loanPurpose.value) return Swal.fire('Info', 'Isi keperluan peminjaman', 'warning');
                const newLoan = {
                    id: 'REQ-' + Date.now().toString().slice(-6),
                    created: new Date().toISOString(),
                    startDate: loanDate.value,
                    endDate: returnDate.value,
                    borrowerId: currentUser.value.id,
                    borrowerName: currentUser.value.name,
                    borrowerNim: currentUser.value.nim,
                    purpose: loanPurpose.value,
                    items: JSON.parse(JSON.stringify(cart.value)),
                    status: 'Pending',
                    returnNote: ''
                };
                loans.value.push(newLoan);
                saveData();
                cart.value = [];
                loanPurpose.value = "";
                Swal.fire('Terkirim', 'Permintaan dikirim. Cek Riwayat.', 'success');
                activeTab.value = 'history';
            };

            const saveClientProfile = () => {
                if(!clientForm.value.name || !clientForm.value.password || !clientForm.value.nim) return Swal.fire('Error', 'Semua field harus diisi', 'error');
                const userIndex = users.value.findIndex(u => u.id === currentUser.value.id);
                if (userIndex !== -1) {
                    users.value[userIndex] = { ...users.value[userIndex], ...clientForm.value };
                    currentUser.value = users.value[userIndex];
                    saveData();
                    localStorage.setItem('sl_current_user', JSON.stringify(currentUser.value));
                    Swal.fire('Berhasil', 'Profil berhasil diperbarui', 'success');
                }
            };

            watch(activeTab, (newTab) => {
                if (newTab === 'client_settings' && currentUser.value) {
                    clientForm.value = { ...currentUser.value };
                }
            });

            const handleLogoUpload = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                if (file.size > 500 * 1024) return Swal.fire('Error', 'Max 500KB', 'error');
                const reader = new FileReader();
                reader.onload = (e) => { settings.value.logo = e.target.result; };
                reader.readAsDataURL(file);
            };

            const removeLogo = () => { settings.value.logo = null; };

            const handleFileUpload = (e) => {
                const reader = new FileReader();
                reader.onload = (evt) => {
                    const wb = XLSX.read(evt.target.result, {type:'array'});
                    const data = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
                    data.forEach(r => {
                        inventory.value.push({id: Date.now()+Math.random(), code: r.Kode, name: r.Nama, type: r.Tipe, stock: r.Stok, unit: r.Satuan, location: r.Lokasi, minStock:2});
                    });
                    saveData();
                    Swal.fire('Sukses', 'Data diimport', 'success');
                };
                reader.readAsArrayBuffer(e.target.files[0]);
            };

            const downloadTemplate = () => {
                const ws = XLSX.utils.json_to_sheet([{Kode:'A1', Nama:'Barang', Tipe:'Alat', Stok:10, Satuan:'Pcs', Lokasi:'Rak A'}]);
                const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Template");
                XLSX.writeFile(wb, "Template_Import.xlsx");
            };

            const saveData = () => {
                localStorage.setItem('sl_users', JSON.stringify(users.value));
                localStorage.setItem('sl_inventory', JSON.stringify(inventory.value));
                localStorage.setItem('sl_loans', JSON.stringify(loans.value));
                localStorage.setItem('sl_settings', JSON.stringify(settings.value));
                localStorage.setItem('sl_deleted_inventory', JSON.stringify(deletedInventory.value));
                localStorage.setItem('sl_deleted_loans', JSON.stringify(deletedLoans.value));
            };

            const loadData = () => {
                users.value = JSON.parse(localStorage.getItem('sl_users')) || [{id:1, name:'Admin Utama', username:'admin', password:'123', role:'admin'}];
                inventory.value = JSON.parse(localStorage.getItem('sl_inventory')) || [{id:1, code:'A1', name:'Mikroskop', type:'Alat', stock:5, minStock:1, location:'A1', unit:'Unit'}];
                loans.value = JSON.parse(localStorage.getItem('sl_loans')) || [];
                deletedInventory.value = JSON.parse(localStorage.getItem('sl_deleted_inventory')) || [];
                deletedLoans.value = JSON.parse(localStorage.getItem('sl_deleted_loans')) || [];
                
                const s = localStorage.getItem('sl_settings');
                if(s) settings.value = JSON.parse(s);
                const c = localStorage.getItem('sl_current_user');
                if(c) {
                    currentUser.value = JSON.parse(c);
                    if(!currentUser.value.role) currentUser.value.role = 'client'; 
                }
            };

            const printLetter = async (loan) => {
                Swal.fire({ title: 'Memproses Surat...', text: 'Mohon tunggu sebentar', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); } });
                setTimeout(async () => {
                    try {
                        const doc = new jsPDF();
                        const s = settings.value;
                        const pageWidth = doc.internal.pageSize.width;
                        
                        // --- Helper Function for Safe Text ---
                        const safeText = (text) => {
                            if (text === null || text === undefined) return "-";
                            return String(text);
                        };

                        if (s.logo && typeof s.logo === 'string' && s.logo.startsWith('data:image')) {
                            try {
                                const imgType = s.logo.includes('image/png') ? 'PNG' : 'JPEG';
                                doc.addImage(s.logo, imgType, 15, 10, 25, 25);
                            } catch (logoErr) { console.warn("Logo skipped:", logoErr); }
                        }
                        
                        // Header Logic using safeText
                        if (s.ministryName) { 
                            doc.setFont("times", "normal"); 
                            doc.setFontSize(14); 
                            doc.text(safeText(s.ministryName).toUpperCase(), pageWidth / 2, 14, { align: 'center' }); 
                        }
                        
                        doc.setFont("times", "bold"); doc.setFontSize(13);
                        const uniY = s.ministryName ? 20 : 15;
                        doc.text(safeText(s.universityName).toUpperCase(), pageWidth / 2, uniY, { align: 'center' });
                        
                        doc.setFontSize(15);
                        const facY = uniY + 6;
                        doc.text(safeText(s.facultyName).toUpperCase(), pageWidth / 2, facY, { align: 'center' });
                        
                        doc.setFont("times", "normal"); doc.setFontSize(10);
                        const addrY = facY + 6;
                        doc.text(safeText(s.address), pageWidth / 2, addrY, { align: 'center' });
                        
                        const contactInfo = `Telp: ${safeText(s.phone)} | Fax: ${safeText(s.fax)} | Email: ${safeText(s.email)}`;
                        doc.text(contactInfo, pageWidth / 2, addrY + 5, { align: 'center' });
                        
                        const lineY = addrY + 8;
                        doc.setLineWidth(1); doc.line(15, lineY, pageWidth - 15, lineY); doc.setLineWidth(0.5); doc.line(15, lineY + 1, pageWidth - 15, lineY + 1);
                        
                        const titleY = lineY + 15;
                        doc.setFontSize(12).setFont("times", "bold");
                        doc.text("SURAT IZIN PEMINJAMAN ALAT & BAHAN", pageWidth / 2, titleY, { align: 'center' });
                        doc.setFontSize(11).setFont("times", "normal");
                        
                        const loanNum = safeText(loan.id).replace('REQ-', '');
                        const letterCode = s.letterCode || '/LAB/2024';
                        doc.text(`Nomor: ${loanNum}${letterCode}`, pageWidth / 2, titleY + 5, { align: 'center' });
                        
                        const contentY = titleY + 20;
                        doc.text("Yang bertanda tangan di bawah ini menerangkan bahwa:", 20, contentY);
                        
                        const labelX = 20, colonX = 60, valueX = 65;
                        doc.text("Nama Peminjam", labelX, contentY + 10); doc.text(":", colonX, contentY + 10); doc.text(safeText(loan.borrowerName), valueX, contentY + 10);
                        doc.text("NIM / NIP", labelX, contentY + 16); doc.text(":", colonX, contentY + 16); doc.text(safeText(loan.borrowerNim), valueX, contentY + 16);
                        doc.text("Keperluan", labelX, contentY + 22); doc.text(":", colonX, contentY + 22); doc.text(safeText(loan.purpose), valueX, contentY + 22);
                        doc.text("Waktu Peminjaman", labelX, contentY + 28); doc.text(":", colonX, contentY + 28); doc.text(`${formatDate(loan.startDate)} s.d ${formatDate(loan.endDate)}`, valueX, contentY + 28);
                        
                        doc.text("Telah diizinkan untuk meminjam alat/bahan laboratorium sebagai berikut:", 20, contentY + 40);
                        
                        const body = loan.items.map((i, index) => [
                            index + 1, 
                            safeText(i.name), 
                            safeText(i.qty) + ' ' + safeText(i.unit), 
                            safeText(i.type), 
                            'Baik'
                        ]);
                        
                        doc.autoTable({ startY: contentY + 45, head: [['No', 'Nama Barang', 'Jumlah', 'Jenis', 'Kondisi']], body: body, theme: 'plain', styles: { lineColor: [0, 0, 0], lineWidth: 0.1, font: 'times', textColor: [0,0,0] }, headStyles: { fillColor: [240, 240, 240], fontStyle: 'bold', halign: 'center' }, columnStyles: { 0: {halign: 'center'}, 2: {halign: 'center'}, 4: {halign: 'center'} }, margin: { left: 20, right: 20 } });
                        
                        const finalY = doc.lastAutoTable.finalY + 20;
                        const dateStr = new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
                        const city = s.city || 'Medan';
                        
                        doc.text(`${safeText(city)}, ${dateStr}`, pageWidth - 60, finalY);
                        doc.text("Mengetahui,", pageWidth - 60, finalY + 5);
                        doc.text("Kepala Laboratorium,", pageWidth - 60, finalY + 10);
                        
                        const qrText = `DOKUMEN VALID\nID: ${safeText(loan.id)}\nDisetujui Oleh: ${safeText(s.headLabName)}\nTanggal: ${dateStr}`;
                        try {
                            if(typeof QRCode !== 'undefined') {
                                const qrDataUrl = await QRCode.toDataURL(qrText, { width: 100, margin: 1 });
                                doc.addImage(qrDataUrl, 'PNG', pageWidth - 65, finalY + 12, 25, 25);
                            } else { throw new Error("Library QRCode belum dimuat"); }
                        } catch (qrErr) { console.warn("QR Code Gagal:", qrErr); doc.setFontSize(8); doc.text("[QR Code N/A]", pageWidth - 60, finalY + 25); doc.setFontSize(11); }
                        
                        doc.text(`( ${safeText(s.headLabName)} )`, pageWidth - 60, finalY + 40);
                        doc.text(`NIP. ${safeText(s.headLabNip)}`, pageWidth - 60, finalY + 45);
                        
                        Swal.close(); window.open(doc.output('bloburl'), '_blank');
                    } catch (error) { Swal.close(); console.error("Print Error Full Trace:", error); Swal.fire('Error', 'Gagal mencetak: ' + error.message, 'error'); }
                }, 500);
            };

            const renderCharts = () => {
                const ctx1 = document.getElementById('loanChart');
                const ctx2 = document.getElementById('categoryChart');
                if(!ctx1 || !ctx2) return;
                new Chart(ctx1, { type: 'line', data: { labels: ['Senin','Selasa','Rabu','Kamis','Jumat'], datasets: [{ label: 'Peminjaman', data: [2,5,3,8,4], borderColor: '#3b82f6', tension:0.4 }] }, options: { responsive: true, maintainAspectRatio: false } });
                const alat = inventory.value.filter(i=>i.type==='Alat').length;
                const bahan = inventory.value.filter(i=>i.type==='Bahan').length;
                new Chart(ctx2, { type: 'doughnut', data: { labels: ['Alat','Bahan'], datasets: [{ data: [alat, bahan], backgroundColor: ['#3b82f6','#f97316'] }] }, options: { responsive: true, maintainAspectRatio: false } });
            };
            const saveSettings = () => { saveData(); Swal.fire('Tersimpan', 'Pengaturan berhasil disimpan.', 'success'); };
            const getInitials = (n) => n ? n.substring(0,2).toUpperCase() : 'US';
            const formatDate = (d) => new Date(d).toLocaleDateString('id-ID', {day:'numeric', month:'short', year: 'numeric'});
            const getStatusColor = (s) => ({'Pending':'bg-orange-100 text-orange-700', 'Dipinjam':'bg-blue-100 text-blue-700', 'Dikembalikan':'bg-emerald-100 text-emerald-700', 'Ditolak':'bg-red-100 text-red-700'}[s]);
            const getStatusColorBorder = (s) => ({'Pending':'bg-orange-500', 'Dipinjam':'bg-blue-500', 'Dikembalikan':'bg-emerald-500', 'Ditolak':'bg-red-500'}[s]);

            onMounted(() => {
                loadData();
                setInterval(() => { currentDate.value = new Date().toLocaleDateString('id-ID', {weekday:'long', day:'numeric', month:'long'}); }, 1000);
            });

            return {
                currentUser, authMode, authForm, handleAuth, logout, navigate,
                sidebarCollapsed, mobileMenuOpen, activeTab, trashTab, currentMenuItems, currentTitle, currentDate, isMobile,
                getBadgeCount, stats, users,
                searchQuery, filteredInventory, openItemModal, modals, itemForm, editingItem, saveItem, deleteItem,
                handleFileUpload, downloadTemplate, settings, saveSettings, handleLogoUpload, removeLogo,
                posSearch, posFilter, filteredPosItems, addToCart, cart, cartCollapsed, updateCartQty, removeFromCart,
                loanDate, returnDate, loanPurpose, submitLoanRequest,
                loans, filteredLoansAdmin, approvalFilter, getStatusColor, approveLoan, rejectLoan, printLetter,
                openReturnModal, selectedLoan, returnItemsState, confirmReturn, returnNote,
                myLoans, formatDate, getStatusColorBorder, getInitials,
                clientForm, saveClientProfile, showPass, clientStats,
                // New Exports
                selectedInventoryIds, toggleAllInventory, isAllInventorySelected, bulkDeleteInventory,
                selectedLoanIds, toggleAllLoans, isAllLoansSelected, bulkDeleteLoans,
                deletedInventory, deletedLoans, restoreItem, permanentDeleteItem, restoreLoan, permanentDeleteLoan
            };
        }
    }).mount('#app');
</script>
</body>
</html>